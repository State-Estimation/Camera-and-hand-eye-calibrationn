import numpy as np
from scipy.spatial.transform import Rotation as R
import json


homogeneous_matrices = [[[-0.885274373250316, -0.412522554510454, 0.214742697399536, 74.3701183157265],
                         [0.451738495725925, -0.652981136316012, 0.607904570713799, -35.7338385361595],
                         [-0.110551415845923, 0.635169880926055, 0.764419784424006, 482.977887115314], [0, 0, 0, 1]],
                        [[-0.917970149358549, -0.312631090473300, 0.244115968662681, 126.503591867480],
                         [0.396130209908905, -0.691097015841558, 0.604537651013086, -30.3383384226448],
                         [-0.0202894476063378, 0.651649227701812, 0.758249050346561, 450.615039781753], [0, 0, 0, 1]],
                        [[-0.934042515840572, 0.222035572615383, -0.279758437040912, 11.9893142978819],
                         [-0.327242681638496, -0.845843923461926, 0.421260352343515, -21.4457803632756],
                         [-0.143097190455511, 0.485023980475085, 0.862713702480634, 384.857256269365], [0, 0, 0, 1]],
                        [[-0.995522936032221, 0.0874674890990957, -0.0358262778486003, 111.175078112082],
                         [-0.0921476045044070, -0.813722117250563, 0.573903419471744, 59.0920295930725],
                         [0.0210452564224086, 0.574635322833500, 0.818138950872133, 319.073902243230], [0, 0, 0, 1]],
                        [[-0.899602054607600, 0.386926914392472, -0.202493719074209, 57.1443346134138],
                         [-0.435347577759981, -0.757956892304190, 0.485771382387942, 8.96327325193395],
                         [0.0344765120669271, 0.525156083776334, 0.850307272571747, 321.451786597178], [0, 0, 0, 1]],
                        [[-0.954411102481145, 0.205470809065847, -0.216520655094502, 113.309140553955],
                         [-0.282894986318976, -0.854071154311075, 0.436500733205953, 7.30373929743439],
                         [-0.0952358870190884, 0.477853753773656, 0.873261653703009, 323.122641402114], [0, 0, 0, 1]],
                        [[-0.889584319305856, 0.231334277264061, -0.393858084857797, 0.303325694715042],
                         [-0.413129892946718, -0.775301388595426, 0.477735751640839, 27.0169736352002],
                         [-0.194842065270749, 0.587700781864988, 0.785267063231555, 380.705505204133], [0, 0, 0, 1]],
                        [[-0.873853071606830, 0.395451734006660, -0.282840476796435, 61.7992183982105],
                         [-0.485202917834336, -0.746374545754174, 0.455525154053315, 25.8315157939950],
                         [-0.0309667203357982, 0.535297079686949, 0.844096024579117, 379.686420590075], [0, 0, 0, 1]],
                        [[-0.557838274290862, 0.653562144780211, -0.511539815309115, 62.1596827514083],
                         [-0.818161626074040, -0.536554628107526, 0.206689827220105, 48.4029399860150],
                         [-0.139384408583151, 0.533821743624860, 0.834030174920092, 436.132395890517], [0, 0, 0, 1]],
                        [[-0.978046630740383, 0.167942087018548, -0.123370350997469, 60.1204611651035],
                         [-0.207354322337773, -0.843164266368898, 0.496062702615749, 6.79793174118477],
                         [-0.0207116659211040, 0.510753830456956, 0.859477487528510, 394.848842973994], [0, 0, 0, 1]],
                        [[-0.781028652480608, 0.507190398845951, -0.364351675339652, 2.22299267588608],
                         [-0.624493950524323, -0.635482492085427, 0.454058705468159, 34.0650282996253],
                         [-0.00124489471447081, 0.582168275991900, 0.813067370311814, 390.968840832051], [0, 0, 0, 1]],
                        [[-0.913984315888948, -0.344515397153176, 0.214340410173635, 117.267711095978],
                         [0.405734756246451, -0.771515306303208, 0.490044324233533, -32.5471314078871],
                         [-0.00346090777770845, 0.534858180515412, 0.844934760116483, 428.170288609781], [0, 0, 0, 1]],
                        [[-0.937513759870091, -0.268655002714214, 0.221116348492984, 89.1045037317612],
                         [0.337386315689599, -0.857279553121561, 0.388898755185839, -36.9825112821102],
                         [0.0850789282939310, 0.439199564339859, 0.894351898664074, 417.474305138177], [0, 0, 0, 1]],
                        [[-0.786759944618008, 0.478598829243842, -0.389810146341899, 71.6138513573180],
                         [-0.579297313035916, -0.790557432024623, 0.198578875462626, 8.89938825805807],
                         [-0.213127690960223, 0.382049875431281, 0.899229937240140, 433.692291029836], [0, 0, 0, 1]],
                        [[-0.940147075808534, 0.114788980246528, -0.320853495948890, 38.7297402082103],
                         [-0.219000127621097, -0.924898153510865, 0.310809185408242, -12.0115956777623],
                         [-0.261079336506368, 0.362473303356474, 0.894679095767438, 375.955372458894], [0, 0, 0, 1]],
                        [[-0.953851360526942, -0.248216732586136, -0.168985312039727, 60.6516091149765],
                         [0.143848296080206, -0.871701394424190, 0.468448873062732, 34.3406282864112],
                         [-0.263581580797526, 0.422522345708703, 0.867179115085858, 309.419250357490], [0, 0, 0, 1]],
                        [[-0.897102752248003, 0.203507121098581, -0.392162598383916, 22.2038176521106],
                         [-0.350169708600735, -0.868752733999825, 0.350214023628846, 58.3655370633344],
                         [-0.269421281801446, 0.451501427273488, 0.850622497987485, 287.006734677783], [0, 0, 0, 1]],
                        [[-0.892684401074307, 0.205817605583015, -0.400940984822804, 12.6258542056660],
                         [-0.358359704251245, -0.863643913481783, 0.354538450770619, 53.2571522752536],
                         [-0.273299986182886, 0.460172037327286, 0.844718185914385, 303.057772441724], [0, 0, 0, 1]],
                        [[-0.917699983400001, -0.00626669939889370, -0.397224708378372, 63.1536000123225],
                         [-0.174074734295928, -0.892435901993179, 0.416240492640279, 43.6407082283932],
                         [-0.357106044960654, 0.451130678753135, 0.817897538411930, 312.558995057469], [0, 0, 0, 1]],
                        [[-0.968740545528467, 0.230439505400314, -0.0918661515470514, 67.7270587058998],
                         [-0.247910159448992, -0.885724644942730, 0.392469624535519, 6.66559557489884],
                         [ 0.00907239170134491, 0.402975790453886, 0.915165670256966, 292.238528852355], [0, 0, 0, 1]]]

results = []
rotvec = []
tvec = []
for matrix in homogeneous_matrices:
    # 提取旋转矩阵部分（3x3）
    rotation_matrix = np.array(matrix)[:3, :3]
    # 转换为旋转向量
    rotation_vector = R.from_matrix(rotation_matrix).as_rotvec()
    rotvec.append(rotation_vector)
    # 提取平移向量部分（前三个元素，第四列）
    translation_vector = np.array(matrix)[:3, 3] / 1000.0  # 除以1000
    tvec.append(translation_vector)
    results.append((rotation_vector, translation_vector))

# 打印结果
# for i, (rot_vec, trans_vec) in enumerate(results):
#     print(f"Matrix {i + 1}:")
#     print("Rotation Vector:", rot_vec)
#     print("Translation Vector:", trans_vec)
#     print()
converted_r = [arr.reshape(-1, 1) for arr in rotvec]
converted_t = [arr.reshape(-1, 1) for arr in tvec]
# print(converted_r)
# print(converted_t)
#print(tvec)
#print(rotvec)
Tr = [arr.tolist() for arr in converted_r]  # 转换为列表
with open('Tr1.json', 'w') as f:
    json.dump(Tr, f)
Tt = [arr.tolist() for arr in converted_t]  # 转换为列表
with open('Tt1.json', 'w') as f:
    json.dump(Tt, f)